数据库驱动。

Node 中的数据库驱动就是 mysql2.



在 SQL 中，将查询到的数据，转成对象

单表查询时，mysql2 会将表转化成数组返回，其中每个元素，时一个个对象。

多表查询时，同样的，mysql2 也会将表转化成数组返回，其中每个元素，时一个个对象。

- 但是，我们往往希望 `brand` 表中查询到的结果，能够作为一个对象返回。
- 使用 JSON_OBJECT('[属性名]', [字段名])



多对多转成数组。

将查询到的结果，转化成数组类型，数组中又存放对象类型。

- 使用 JSON_ARRAYAGG()



以上两种方式，可以通过代码处理，但 MySQL 已提供了函数，更加方便。

---

mysql2

Java 中，提供了数据库相关的结构，库只是对接口功能的实现。Node 中也一样。



下载 mysql2

基本使用：

创建一个连接。

定义一个 SQL 语句，使用 statement 名命（不成文的规范）。

执行 SQL 语句

- 使用 connection.query()
- 这里的 query() 指的是 SQL（Structure Query Language） 中的 query
- 回调函数中，分别时 err, values, fields

销毁连接 connection.distroy()

---

预处理语句。

优点：1.提高新能；2.防止 SQL 注入。

MySQL 在执行 SQL 语句时，会先解析，再优化，再转化成真正能够运行的代码。

- 解析-优化-转换 => 执行

每次 SQL 执行时，都需要经理以上的过程。 

而实际情况中，可能有多个客户端，频繁的取执行多条 SQL 语句。

当我们将预处理语句传给 MySQL 时，会经过 解析，优化，转换，并存储起来。

当客户端真正传值过来的时候，就不需要再经过解析，优化，转换，的过程，直接执行 SQL。

所以预处理语句，执行性能更高。



SQL 注入

比如再登录 admin 帐号时，

如果后端程序，直接在 SQL 上，拼接前端传过来的参数。

那么在输入 password 时，在后方写上“OR 1 = 1”，相当于再 SQL 的 WHERE 字句后，拼接上"OR 1 = 1"

预处理语句可以有效防止这种情况。



使用预处理语句查询

编写预处理语句时，使用 ”?“ 代替查询条件，

使用 connection.execute(statement, [[条件1], [条件2], ...])

销毁连接 connection.distroy()

---

连接池

通常用 Set 数据类型来保存。

创建连接池，设置最大上限。

---

使用 Promise 的形式，查询数据。

返回的结果 res 是一个数组，res[0]: values， res[1]: fields

---

补充：

Node 中，其它流行的 http 服务框架：

egg.js 基于 Koa

nest.js 类似于 spring，要使用 Typescript 开发。

---

coderhub 项目介绍

---

项目接口功能说明。

1.用户管理系统 
2.内容管理系统
3.内容评论管理（一对多） 
4.内容标签管理（多对多）
5.文件管理系统

其他功能其实都是非常相似的

---

项目搭建

初始化项目，添加 start 命令。

安装 koa，和一些插件。

使用 Koa 搭建服务器。